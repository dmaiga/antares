{% extends 'base_candidate.html' %}
{% load static %}

{% block title %}Détail de la Candidature - {{ candidature.offre.titre }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'candidature_list' %}">Mes Candidatures</a></li>
                    <li class="breadcrumb-item active">Détail</li>
                </ol>
            </nav>

            <!-- Note importante -->
            <div class="alert alert-info mb-4">
                <div class="d-flex">
                    <div class="me-3">
                        <i class="fas fa-info-circle fa-2x"></i>
                    </div>
                    <div>
                        <h6 class="alert-heading">Important</h6>
                        <p class="mb-1">Seules les personnes retenues pour la sélection seront contactées.</p>
                        <p class="mb-0">Vous pouvez suivre l'évolution de votre candidature via cette plateforme et continuer à mettre à jour vos documents et profil pour correspondre aux offres qui vous intéressent.</p>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-file-alt me-2"></i>Détail de la Candidature
                        </h3>
                        <span class="badge bg-{% if candidature.statut == 'POSTULE' %}info{% elif candidature.statut == 'EN_REVUE' %}primary{% elif candidature.statut == 'ENTRETIEN' %}warning{% elif candidature.statut == 'ACCEPTE' %}success{% elif candidature.statut == 'REFUSE' %}danger{% else %}secondary{% endif %} fs-6">
                            {{ candidature.get_statut_display }}
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h4 class="text-primary">{{ candidature.offre.titre }}</h4>
                            <h6 class="text-muted mb-3">
                                <i class="fas fa-building me-1"></i>Antares
                            </h6>
                            
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <h6 class="border-bottom pb-2">Informations sur l'offre</h6>
                                    <ul class="list-unstyled">
                                        {% if candidature.offre.lieu %}
                                        <li class="mb-2">
                                            <i class="fas fa-map-marker-alt text-muted me-2"></i>
                                            <strong>Lieu:</strong> {{ candidature.offre.lieu }}
                                        </li>
                                        {% endif %}
                                        {% if candidature.offre.type_contrat %}
                                        <li class="mb-2">
                                            <i class="fas fa-file-contract text-muted me-2"></i>
                                            <strong>Contrat:</strong> {{ candidature.offre.get_type_contrat_display }}
                                        </li>
                                        {% endif %}
                                        {% if candidature.offre.salaire %}
                                        <li class="mb-2">
                                            <i class="fas fa-euro-sign text-muted me-2"></i>
                                            <strong>Salaire:</strong> {{ candidature.offre.salaire }}
                                        </li>
                                        {% endif %}
                                        <li class="mb-2">
                                            <i class="fas fa-calendar text-muted me-2"></i>
                                            <strong>Publiée le:</strong> {{ candidature.offre.date_publication|date:"d/m/Y" }}
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="border-bottom pb-2">Votre candidature</h6>
                                    <ul class="list-unstyled">
                                        <li class="mb-2">
                                            <i class="fas fa-paper-plane text-muted me-2"></i>
                                            <strong>Postulé le:</strong> {{ candidature.date_postulation|date:"d/m/Y à H:i" }}
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-sync-alt text-muted me-2"></i>
                                            <strong>Dernière mise à jour:</strong> {{ candidature.date_mise_a_jour|date:"d/m/Y" }}
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-file text-muted me-2"></i>
                                            <strong>CV utilisé:</strong> {{ candidature.cv_utilise.nom }}
                                        </li>
                                        {% if candidature.date_entretien %}
                                        <li class="mb-2">
                                            <i class="fas fa-calendar-check text-muted me-2"></i>
                                            <strong>Entretien prévu:</strong> {{ candidature.date_entretien|date:"d/m/Y à H:i" }}
                                        </li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Motivation -->
                            {% if candidature.motivation %}
                            <div class="mt-4">
                                <h6 class="border-bottom pb-2">Votre motivation</h6>
                                <div class="p-3 bg-light rounded">
                                    {{ candidature.motivation|safe }}
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Points forts -->
                            {% if candidature.points_forts %}
                            <div class="mt-4">
                                <h6 class="border-bottom pb-2">Vos points forts</h6>
                                <div class="p-3 bg-light rounded">
                                    {{ candidature.points_forts|linebreaks }}
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Documents joints -->
                            <div class="mt-4">
                                <h6 class="border-bottom pb-2">Documents joints</h6>
                                <div class="d-flex flex-wrap gap-2">
                                    <span class="badge bg-primary">
                                        <i class="fas fa-file-pdf me-1"></i>{{ candidature.cv_utilise.nom }}
                                    </span>
                                    {% for doc in candidature.documents_supplementaires.all %}
                                    <span class="badge bg-secondary">
                                        <i class="fas fa-file me-1"></i>{{ doc.nom }}
                                    </span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sidebar -->
                        <div class="col-md-4">
                            <!-- Logo Antares -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">Antares</h6>
                                </div>
                                <div class="card-body text-center">
                                    <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" 
                                         style="width: 100px; height: 100px;">
                                        <span class="text-white fw-bold fs-2">A</span>
                                    </div>
                                    <h6>Antares Recrutement</h6>
                                    <p class="text-muted small">Votre partenaire pour l'emploi</p>
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6 class="mb-0">Actions</h6>
                                </div>
                                <div class="card-body">
                                    <a href="{% url 'candidat_job_detail' candidature.offre.pk %}" 
                                       class="btn btn-outline-primary w-100 mb-2">
                                        <i class="fas fa-eye me-1"></i>Voir l'offre
                                    </a>
                                    {% if candidature.statut == 'POSTULE' or candidature.statut == 'EN_REVUE' %}
                                    <a href="{% url 'withdraw_candidature' candidature.pk %}" 
                                       class="btn btn-outline-danger w-100"
                                       onclick="return confirm('Êtes-vous sûr de vouloir retirer votre candidature ? Cette action est irréversible.')">
                                        <i class="fas fa-times me-1"></i>Retirer la candidature
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Conseils -->
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Conseils</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <a href="{% url 'edit_profil' %}" class="btn btn-outline-info btn-sm text-start">
                                            <i class="fas fa-user-edit me-1"></i>Compléter mon profil
                                        </a>
                                        <a href="{% url 'document_list' %}" class="btn btn-outline-info btn-sm text-start">
                                            <i class="fas fa-file-upload me-1"></i>Ajouter des documents
                                        </a>
                                        <a href="{% url 'candidat_job_list' %}" class="btn btn-outline-info btn-sm text-start">
                                            <i class="fas fa-search me-1"></i>Voir d'autres offres
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .card {
        border: none;
        border-radius: 12px;
    }
    
    .card-header {
        border-radius: 12px 12px 0 0 !important;
        background-color: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
    }
    
    .badge {
        font-size: 0.75rem;
        padding: 0.5rem 0.75rem;
        border-radius: 20px;
    }
    
    .bg-POSTULE { background-color: #0dcaf0; }
    .bg-EN_REVUE { background-color: #0d6efd; }
    .bg-ENTRETIEN { background-color: #ffc107; color: #000; }
    .bg-ACCEPTE { background-color: #198754; }
    .bg-REFUSE { background-color: #dc3545; }
    .bg-RETIRE { background-color: #6c757d; }
    
    .list-unstyled li {
        padding: 0.25rem 0;
    }
    
    .border-bottom {
        border-color: #dee2e6 !important;
    }
    
    .btn {
        border-radius: 8px;
    }
    
    @media (max-width: 768px) {
        .card-body .row {
            flex-direction: column;
        }
        
        .col-md-4 {
            margin-top: 2rem;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Confirmation pour le retrait de candidature
        const retirerBtn = document.querySelector('a[href*="withdraw_candidature"]');
        if (retirerBtn) {
            retirerBtn.addEventListener('click', function(e) {
                if (!confirm('Êtes-vous sûr de vouloir retirer votre candidature ? Cette action est irréversible.')) {
                    e.preventDefault();
                }
            });
        }
    });
</script>
{% endblock %}