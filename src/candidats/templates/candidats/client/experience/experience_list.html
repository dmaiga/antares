{% extends 'base_candidate.html' %}
{% load static %}

{% block title %}Mes Expériences Professionnelles{% endblock %}

{% block content %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap Icons (déjà présent) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

<!-- Optionnel : FontAwesome (puisque tu utilises fa-*) -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <style>
    :root {
      --secondary-blue: #2D76B6;
      --light-gray: #F4F4F9;
      --dark-gray: #333333;
      --light-blue: #E6F0FA;
      --accent-orange: #FA8301;
      --primary-blue: #0A4B8C;
    }
    
    .card {
        border: 1px solid #dee2e6;
        border-radius: 8px;
    }
    
    .card-header {
        border-radius: 8px 8px 0 0;
    }
    
    .badge {
        font-size: 0.75rem;
        padding: 0.4rem 0.6rem;
        border-radius: 6px;
    }
    
    .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
    }
    
   
    
    /* Style avec vos couleurs personnalisées */
    .bg-primary-custom {
        background-color: var(--primary-blue) !important;
    }
    
    .bg-secondary-custom {
        background-color: var(--secondary-blue) !important;
    }
    
    .bg-accent-custom {
        background-color: var(--accent-orange) !important;
    }
    
    .bg-light-custom {
        background-color: var(--light-gray) !important;
    }
    
    .text-primary-custom {
        color: var(--primary-blue) !important;
    }
    
    .text-secondary-custom {
        color: var(--secondary-blue) !important;
    }
    
    .text-accent-custom {
        color: var(--accent-orange) !important;
    }
    
    .btn-primary-custom {
        background-color: var(--primary-blue);
        border-color: var(--primary-blue);
        color: white;
    }
    
    .btn-primary-custom:hover {
        background-color: var(--secondary-blue);
        border-color: var(--secondary-blue);
        color: white;
    }
    
    .btn-outline-primary-custom {
        color: var(--primary-blue);
        border-color: var(--primary-blue);
    }
    
    .btn-outline-primary-custom:hover {
        background-color: var(--primary-blue);
        color: white;
    }
    
    .border-accent {
        border-color: var(--accent-orange) !important;
    }
    
    /* Responsive design */
    @media (max-width: 991.98px) {
      
        .d-flex.justify-content-between {
            flex-direction: column;
            gap: 1rem;
            text-align: center;
        }
        
        .flex-shrink-0.ms-3 {
            margin-left: 0 !important;
            margin-top: 1rem;
        }
        
        .d-flex.flex-wrap.gap-2 {
            gap: 0.5rem !important;
        }
    }
    
    @media (max-width: 576px) {
        .btn {
            font-size: 0.8rem;
            padding: 0.3rem 0.6rem;
        }
        
        .card-body {
            padding: 1rem;
        }
        
        .date-display {
            display: block;
            width: 100%;
            margin-top: 0.5rem;
        }
    }
  </style>
  
<div class="container mt-4">
    <div class="row">
        <!-- Contenu principal (9 colonnes) -->
        <div class="col-lg-9">
            <!-- En-tête avec actions -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-briefcase me-2 text-primary-custom"></i>Mes Expériences Professionnelles</h2>
                <div class="d-flex gap-2">
                    <a href="{% url 'competence_create' %}" class="btn btn-outline-primary-custom btn-sm">
                        <i class="fas fa-plus me-1"></i> Compétences
                    </a>
                    <a href="{% url 'add_experience' %}" class="btn btn-primary-custom btn-sm">
                        <i class="fas fa-plus me-1"></i> Nouvelle expérience
                    </a>
                </div>
            </div>

            {% if experiences %}
                <!-- Liste des expériences -->
                <div class="row">
                    {% for experience in experiences %}
                        <div class="col-md-12 mb-4">
                            <div class="card h-100 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <h5 class="card-title text-primary-custom mb-1">{{ experience.poste }}</h5>
                                            <h6 class="card-subtitle mb-2 text-muted">
                                                <i class="fas fa-building me-1 text-secondary-custom"></i>
                                                {{ experience.entreprise }}
                                            </h6>
                                            
                                            <div class="d-flex flex-wrap gap-2 mb-3">
                                                <span class="badge bg-light-custom text-dark border">
                                                    <i class="fas fa-map-marker-alt me-1 text-secondary-custom"></i>{{ experience.lieu }}
                                                </span>
                                                <span class="badge bg-secondary-custom text-white">
                                                    <i class="fas fa-file-contract me-1"></i>{{ experience.get_type_contrat_display }}
                                                </span>
                                                <span class="badge bg-light-custom text-dark border date-display">
                                                    <i class="fas fa-calendar me-1 text-secondary-custom"></i>
                                                    {{ experience.date_debut|date:"d/m/Y" }} - 
                                                    {% if experience.en_poste %}
                                                        <span class="text-success">En cours</span>
                                                    {% else %}
                                                        {{ experience.date_fin|date:"d/m/Y" }}
                                                    {% endif %}
                                                </span>
                                                {% if experience.duree %}
                                                <span class="badge bg-accent-custom text-white">
                                                    <i class="fas fa-clock me-1"></i>{{ experience.duree }} mois
                                                </span>
                                                {% endif %}
                                            </div>

                                            {% if experience.description %}
                                                <div class="mt-3">
                                                    <h6 class="text-muted mb-2">Missions principales</h6>
                                                    <div class="card-text">
                                                        {{ experience.description|safe|truncatewords:30 }}
                                                    </div>
                                                </div>
                                            {% endif %}

                                            {% if experience.competences.exists %}
                                                <div class="mt-3">
                                                    <h6 class="text-muted mb-2">Compétences utilisées</h6>
                                                    <div class="d-flex flex-wrap gap-1">
                                                        {% for competence in experience.competences.all|slice:":5" %}
                                                            <span class="badge bg-light text-dark border small">
                                                                {{ competence.nom }}
                                                            </span>
                                                        {% endfor %}
                                                        {% if experience.competences.count > 5 %}
                                                            <span class="badge bg-light text-dark border small">
                                                                +{{ experience.competences.count|add:"-5" }} autre(s)
                                                            </span>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            {% endif %}
                                        </div>
                                        
                                        <div class="flex-shrink-0 ms-3">
                                            <div class="d-flex flex-column gap-2">
                                                <a href="{% url 'edit_experience' experience.pk %}" 
                                                   class="btn btn-sm btn-outline-primary-custom"
                                                   title="Modifier cette expérience">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <a href="{% url 'delete_experience' experience.pk %}" 
                                                   class="btn btn-sm btn-outline-danger"
                                                   title="Supprimer cette expérience"
                                                   onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette expérience ?')">
                                                    <i class="fas fa-trash"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer bg-transparent py-2">
                                    <small class="text-muted">
                                        <i class="fas fa-history me-1"></i>
                                        Ajoutée le {{ experience.date_creation|date:"d/m/Y" }}
                                    </small>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <!-- Call to action en bas de page -->
                <div class="text-center mt-4 pt-3 border-top">
                    <h5 class="mb-3">Continuez à enrichir votre profil</h5>
                    <div class="d-flex justify-content-center gap-2 flex-wrap">
                        <a href="{% url 'add_experience' %}" class="btn btn-primary-custom btn-sm">
                            <i class="fas fa-plus me-1"></i>Autre expérience
                        </a>
                        <a href="{% url 'competence_create' %}" class="btn btn-outline-primary-custom btn-sm">
                            <i class="fas fa-star me-1"></i>Compétences
                        </a>
                        <a href="{% url 'document_list' %}" class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-file me-1"></i>Documents
                        </a>
                    </div>
                </div>

            {% else %}
                <!-- État vide -->
                <div class="text-center py-5">
                    <div class="mb-4">
                        <i class="fas fa-briefcase fa-4x text-muted opacity-50"></i>
                    </div>
                    <h4 class="text-muted mb-3">Aucune expérience professionnelle</h4>
                    <p class="text-muted mb-4">
                        Commencez par ajouter vos expériences professionnelles pour enrichir votre profil.
                    </p>
                    <div class="d-flex justify-content-center gap-2 flex-wrap">
                        <a href="{% url 'add_experience' %}" class="btn btn-primary-custom">
                            <i class="fas fa-plus me-2"></i>Ajouter une expérience
                        </a>
                        <a href="{% url 'competence_create' %}" class="btn btn-outline-primary-custom">
                            <i class="fas fa-star me-2"></i>Ajouter des compétences
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- Sidebar conseils (3 colonnes) -->
        <div class="col-lg-3">
            <div>
                <!-- Conseils pour les expériences -->
                <div class="card shadow-sm mb-3">
                    <div class="card-header bg-primary-custom text-white py-2">
                        <h6 class="mb-0">
                            <i class="fas fa-lightbulb me-1"></i>
                            Conseils pratiques
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-2">
                            <span class="badge bg-primary-custom rounded-pill me-1">1</span>
                            <small>Ajoutez toutes vos expériences significatives</small>
                        </div>
                        <div class="mb-2">
                            <span class="badge bg-primary-custom rounded-pill me-1">2</span>
                            <small>Décrivez vos missions et réalisations</small>
                        </div>
                        <div class="mb-2">
                            <span class="badge bg-primary-custom rounded-pill me-1">3</span>
                            <small>Associez les compétences utilisées</small>
                        </div>
                        <div class="mb-2">
                            <span class="badge bg-primary-custom rounded-pill me-1">4</span>
                            <small>Mentionnez les outils et technologies</small>
                        </div>
                        <div>
                            <span class="badge bg-primary-custom rounded-pill me-1">5</span>
                            <small>Quantifiez vos résultats quand possible</small>
                        </div>
                    </div>
                </div>

                <!-- Types d'expériences à ajouter -->
                <div class="card shadow-sm mb-3">
                    <div class="card-header bg-success text-white py-2">
                        <h6 class="mb-0">
                            <i class="fas fa-check-circle me-1"></i>
                            À inclure
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-1">
                            <i class="fas fa-check text-success me-1 small"></i>
                            <small>Emplois à temps plein</small>
                        </div>
                        <div class="mb-1">
                            <i class="fas fa-check text-success me-1 small"></i>
                            <small>Stages et alternances</small>
                        </div>
                        <div class="mb-1">
                            <i class="fas fa-check text-success me-1 small"></i>
                            <small>Emplois temporaires</small>
                        </div>
                        <div class="mb-1">
                            <i class="fas fa-check text-success me-1 small"></i>
                            <small>Freelance et indépendant</small>
                        </div>
                        <div>
                            <i class="fas fa-check text-success me-1 small"></i>
                            <small>Bénévolat significatif</small>
                        </div>
                    </div>
                </div>

                <!-- Actions rapides -->
                <div class="card shadow-sm">
                    <div class="card-header bg-secondary-custom text-white py-2">
                        <h6 class="mb-0">
                            <i class="fas fa-bolt me-1"></i>
                            Actions rapides
                        </h6>
                    </div>
                    <div class="card-body">
                        <a href="{% url 'add_experience' %}" class="btn btn-primary-custom btn-sm w-100 mb-2 text-start">
                            <i class="fas fa-plus me-1"></i>Nouvelle expérience
                        </a>
                        <a href="{% url 'competence_create' %}" class="btn btn-outline-primary-custom btn-sm w-100 mb-2 text-start">
                            <i class="fas fa-star me-1"></i>Gérer les compétences
                        </a>
                        <a href="{% url 'edit_profil' %}" class="btn btn-outline-secondary btn-sm w-100 text-start">
                            <i class="fas fa-user me-1"></i>Compléter mon profil
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Confirmation de suppression
    const deleteButtons = document.querySelectorAll('a[href*="delete_experience"]');
    deleteButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer cette expérience ? Cette action est irréversible.')) {
                e.preventDefault();
            }
        });
    });
    
    // Animation des cartes
    const cards = document.querySelectorAll('.card');
    cards.forEach(card => {
        card.style.transition = 'transform 0.2s ease-in-out';
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}