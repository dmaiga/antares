{% extends 'site_web/layout.html' %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<!-- Hero Section Consultant -->
<section class="consultant-hero" style="background: linear-gradient(rgba(13, 59, 102, 0.9), rgba(13, 59, 102, 0.8))">
  <div class="container py-5 text-white text-center">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <h1 class="display-4 fw-bold mb-4">Rejoignez notre réseau de consultants experts</h1>
        <p class="lead mb-4">Antares connecte vos compétences avec les entreprises qui en ont besoin</p>
        <div class="d-flex flex-wrap gap-3 justify-content-center">
          <a href="#registration-form" class="btn btn-orange btn-lg px-4">
            <i class="bi bi-person-plus me-2"></i> S'inscrire
          </a>
          <a href="#advantages" class="btn btn-outline-light btn-lg px-4">
            <i class="bi bi-info-circle me-2"></i> En savoir plus
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Avantages Consultant -->
<!-- Avantages Consultant amélioré -->
<section id="advantages" class="py-5 bg-light-blue">
  <div class="container">
    <div class="text-center mb-5">
      <h2 class="fw-bold section-title">Rejoignez notre réseau de consultants experts</h2>
      <p class="lead text-muted">Antares vous connecte aux meilleures opportunités en intérim, conseil et formation</p>
    </div>
    
    <div class="row g-4">
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 border-0 shadow-sm advantage-card hover-effect">
          <div class="card-body p-4 text-center">
            <div class="advantage-icon">
              <i class="bi bi-diagram-3"></i>
            </div>
            <h3 class="advantage-title">Accès privilégié à notre réseau</h3>
            <p class="advantage-text">Bénéficiez de notre portefeuille étendu d'entreprises clientes dans divers secteurs d'activité, avec des besoins réguliers en consulting, intérim et formation.</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 border-0 shadow-sm advantage-card hover-effect">
          <div class="card-body p-4 text-center">
            <div class="advantage-icon">
              <i class="bi bi-briefcase"></i>
            </div>
            <h3 class="advantage-title">Diversité des missions</h3>
            <p class="advantage-text">Interventions en intérim, missions de conseil, formations sur mesure, et projets spécifiques adaptés à votre expertise et disponibilités.</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 border-0 shadow-sm advantage-card hover-effect">
          <div class="card-body p-4 text-center">
            <div class="advantage-icon">
              <i class="bi bi-cash-coin"></i>
            </div>
            <h3 class="advantage-title">Rémunération compétitive</h3>
            <p class="advantage-text">Des conditions financières attractives, un traitement transparent et un paiement rigoureux pour toutes vos prestations, y compris les missions d'intérim.</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 border-0 shadow-sm advantage-card hover-effect">
          <div class="card-body p-4 text-center">
            <div class="advantage-icon">
              <i class="bi bi-graph-up-arrow"></i>
            </div>
            <h3 class="advantage-title">Développement continu</h3>
            <p class="advantage-text">Accédez à nos programmes de formation pour maintenir et enrichir votre expertise, avec une reconnaissance de vos certifications et spécialisations.</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 border-0 shadow-sm advantage-card hover-effect">
          <div class="card-body p-4 text-center">
            <div class="advantage-icon">
              <i class="bi bi-file-earmark-text"></i>
            </div>
            <h3 class="advantage-title">Gestion administrative simplifiée</h3>
            <p class="advantage-text">Nous prenons en charge l'ensemble des aspects administratifs, contractuels et fiscaux de vos missions, pour vous concentrer sur l'expertise métier.</p>
          </div>
        </div>
      </div>
      
      <div class="col-md-6 col-lg-4">
        <div class="card h-100 border-0 shadow-sm advantage-card hover-effect">
          <div class="card-body p-4 text-center">
            <div class="advantage-icon">
              <i class="bi bi-shield-check"></i>
            </div>
            <h3 class="advantage-title">Sécurité et accompagnement</h3>
            <p class="advantage-text">Un suivi personnalisé tout au long de vos missions, une assurance responsabilité civile professionnelle et un support juridique si nécessaire.</p>
          </div>
        </div>
      </div>
    </div>
    
    
  </div>
</section>

<!-- Processus Consultant -->
<section class="py-5" style="background-color: var(--light-blue);">
  <div class="container">
    <div class="row align-items-center g-4 g-lg-5">
      <div class="col-lg-6 order-lg-1 order-2">
        <div class="position-relative h-100">
          <img src="{% static 'site_web/images/consultant/consultant_hero.jpg' %}" 
               alt="Processus consultant Antares"
               loading="lazy"
               width="600"
               height="400"
               class="img-fluid rounded-3 shadow w-100 h-100 object-fit-cover"
               style="min-height: 300px; max-height: 500px;">
        </div>
      </div>
      
      <div class="col-lg-6 order-lg-2 order-1">
        <h2 class="fw-bold mb-4 display-5" style="color: var(--primary-blue);">
          Comment devenir consultant Antares ?
        </h2>
        
        <div class="process-steps">
          <div class="d-flex mb-3 align-items-start">
            <div class="flex-shrink-0 bg-primary-blue text-white rounded-circle d-flex align-items-center justify-content-center mt-1" 
                 style="width: 32px; height: 32px; font-size: 1rem;">
              1
            </div>
            <div class="flex-grow-1 ms-3">
              <p class="mb-0 lead" style="font-size: 1.1rem;">Enregistrez votre profil et compétences</p>
            </div>
          </div>
          <div class="d-flex mb-3 align-items-start">
            <div class="flex-shrink-0 bg-primary-blue text-white rounded-circle d-flex align-items-center justify-content-center mt-1" 
                 style="width: 32px; height: 32px; font-size: 1rem;">
              2
            </div>
            <div class="flex-grow-1 ms-3">
              <p class="mb-0 lead" style="font-size: 1.1rem;">Validez notre processus de qualification</p>
            </div>
          </div>
          <div class="d-flex mb-3 align-items-start">
            <div class="flex-shrink-0 bg-primary-blue text-white rounded-circle d-flex align-items-center justify-content-center mt-1" 
                 style="width: 32px; height: 32px; font-size: 1rem;">
              3
            </div>
            <div class="flex-grow-1 ms-3">
              <p class="mb-0 lead" style="font-size: 1.1rem;">Recevez les demandes correspondant à votre profil</p>
            </div>
          </div>
          <div class="d-flex mb-3 align-items-start">
            <div class="flex-shrink-0 bg-primary-blue text-white rounded-circle d-flex align-items-center justify-content-center mt-1" 
                 style="width: 32px; height: 32px; font-size: 1rem;">
              4
            </div>
            <div class="flex-grow-1 ms-3">
              <p class="mb-0 lead" style="font-size: 1.1rem;">Intervenez chez nos clients entreprises</p>
            </div>
          </div>
        </div>
        
        <div class="mt-4 pt-2">
          <a href="#registration-form" class="btn btn-orange btn-lg px-4 py-3">
            Postuler maintenant <i class="bi bi-arrow-right ms-2"></i>
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Formulaire d'inscription optimisé -->
<section id="registration-form" class="py-5" style="background-color: var(--light-gray);">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="card border-0 shadow-lg">
          <div class="card-header py-3" style="background-color: var(--primary-blue); color: white;">
            <h3 class="mb-0 text-center">
              <i class="bi bi-lightning-charge me-2"></i> Inscription Consultant
            </h3>
          </div>
          
          <div class="card-body p-4 p-md-5 consultant-form">
            {% if messages %}
            <div class="mb-4">
              {% for message in messages %}
              <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
              {% endfor %}
            </div>
            {% endif %}
            
            <form method="post" enctype="multipart/form-data" class="row g-3 needs-validation" novalidate>
              {% csrf_token %}
              
              <!-- Section 1: Informations personnelles -->
              <div class="col-12">
                <h5 class="fw-bold mb-3" style="color: var(--primary-blue);">
                  <i class="bi bi-person-badge me-2"></i>Vos coordonnées
                </h5>
                <hr class="mt-0 mb-3" style="border-color: var(--light-blue);">
              </div>
              
              <div class="col-md-6 mb-3">
                <label for="id_first_name" class="form-label fw-bold">Prénom*</label>
                {{ form.first_name|add_class:"form-control"|attr:"required" }}
                <div class="invalid-feedback">Veuillez renseigner votre prénom.</div>
              </div>
              
              <div class="col-md-6 mb-3">
                <label for="id_last_name" class="form-label fw-bold">Nom*</label>
                {{ form.last_name|add_class:"form-control"|attr:"required" }}
                <div class="invalid-feedback">Veuillez renseigner votre nom.</div>
              </div>
              
              <div class="col-md-6 mb-3">
                <label for="id_email" class="form-label fw-bold">Email professionnel*</label>
                {{ form.email|add_class:"form-control"|attr:"required" }}
                
                <div class="invalid-feedback">Veuillez renseigner un email valide.</div>
              </div>
              
              <div class="col-md-6 mb-3">
                <label for="id_phone" class="form-label fw-bold">Téléphone*</label>
                {{ form.phone|add_class:"form-control"|attr:"required" }}
                <small class="form-text text-muted">Format international recommandé (+223 XX XX XX XX)</small>
                <div class="invalid-feedback">Format de téléphone invalide.</div>
              </div>
              
              <!-- Section 2: Expertise -->
              <div class="col-12 mt-4">
                <h5 class="fw-bold mb-3" style="color: var(--primary-blue);">
                  <i class="bi bi-award me-2"></i>Votre expertise
                </h5>
                <hr class="mt-0 mb-3" style="border-color: var(--light-blue);">
              </div>
              
              <div class="col-md-8 mb-3">
                <label for="id_expertise" class="form-label fw-bold">Domaine principal*</label>
                {{ form.expertise|add_class:"form-control"|attr:"required" }}
                <small class="form-text text-muted">Ex: Transformation digitale RH, Audit financier</small>
                <div class="invalid-feedback">Veuillez renseigner votre domaine d'expertise.</div>
              </div>
              
              <div class="col-md-4 mb-3">
                <label for="id_experience" class="form-label fw-bold">Expérience*</label>
                {{ form.experience|add_class:"form-select"|attr:"required" }}
                <div class="invalid-feedback">Veuillez sélectionner votre niveau d'expérience.</div>
              </div>
              <!-- Section 3: Missions - Version simplifiée sans JS -->
<div class="col-12 mt-4">
  <h5 class="fw-bold mb-3" style="color: var(--primary-blue);">
    <i class="bi bi-briefcase me-2"></i>Vos missions types
    
  </h5>
  <hr class="mt-0 mb-3" style="border-color: var(--light-blue);">

  {{ formset.management_form }}
  
  {% for form in formset|slice:":3" %}
  <div class="card mb-3 mission-card">
    <div class="card-body">
      {{ form.id }}
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label small fw-bold">Mission*</label>
          {{ form.name|add_class:"form-control"|attr:"required" }}
        </div>
        <div class="col-md-6">
          <label class="form-label small fw-bold">Expérience*</label>
          {{ form.experience|add_class:"form-select"|attr:"required" }}
        </div>
        <div class="col-12">
          <label class="form-label small fw-bold">Détails </label>
          {{ form.details|add_class:"form-control"|attr:"rows:2" }}
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

              <!-- Section 4: CV et Message -->
              <div class="col-12 mt-4">
                <h5 class="fw-bold mb-3" style="color: var(--primary-blue);">
                  <i class="bi bi-chat-left-text me-2"></i>Compléments
                </h5>
                <hr class="mt-0 mb-3" style="border-color: var(--light-blue);">
              </div>
              
              <div class="col-12 mb-3">
                <label for="id_cv" class="form-label fw-bold">CV (PDF)</label>
                {{ form.cv|add_class:"form-control" }}
                <small id="cv-filename" class="form-text text-muted d-block">Aucun fichier sélectionné</small>
                <div class="form-text">Vous pouvez l'uploader maintenant ou plus tard depuis votre espace</div>
              </div>
              
              <div class="col-12 mb-3">
                <label for="id_personal_message" class="form-label fw-bold">Message à notre équipe (facultatif)</label>
                {{ form.personal_message|add_class:"form-control"|attr:"rows:3" }}
                <div class="form-text">Précisez vos disponibilités, attentes particulières ou autres informations utiles</div>
              </div>
              
              <!-- Message d'information -->
              <div class="col-12 mt-3 mb-4">
                <div class="alert p-3" style="background-color: var(--light-blue); border-left: 4px solid var(--accent-orange);">
                  <i class="bi bi-info-circle-fill me-2" style="color: var(--accent-orange);"></i>
                  <strong>Notre processus de sélection :</strong><br>
                  - Profils <strong>10+ ans d'expérience</strong> intégrés immédiatement<br>
                  - Les autres profils seront conservés dans notre vivier 
                  et <strong>contactés pour des missions</strong> correspondant à leur expertise
                </div>
              </div>
              
              <!-- Validation -->
              <div class="col-12 mb-4">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="conditions" required>
                  <label class="form-check-label" for="conditions">
                    J'accepte les <a href="#" style="color: var(--primary-blue);">conditions générales</a>*
                  </label>
                  <div class="invalid-feedback">Vous devez accepter les conditions générales.</div>
                </div>
              </div>
              
              <!-- Bouton de soumission -->
              <div class="col-12">
                <button type="submit" class="btn w-100 py-3 fw-bold" style="background-color: var(--accent-orange); color: white;">
                  <i class="bi bi-send-check me-2"></i> Envoyer ma candidature
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<style>
  .consultant-form .form-label {
    font-size: 0.9rem;
    margin-bottom: 0.3rem;
  }
  
  .consultant-form .form-control, 
  .consultant-form .form-select {
    font-size: 0.9rem;
    padding: 0.5rem 0.75rem;
    border: 1px solid #ced4da;
  }
  
  .consultant-form textarea.form-control {
    min-height: 100px;
  }
  
  .mission-card {
    transition: all 0.2s ease;
    background-color: rgba(232, 240, 254, 0.5);
    border: 1px solid rgba(10, 75, 140, 0.1);
  }
  
  .mission-card:hover {
    border-color: var(--secondary-blue);
    box-shadow: 0 0 0 1px var(--secondary-blue);
  }
  
  #add-mission {
    font-size: 0.85rem;
    padding: 0.4rem 0.8rem;
  }
  
  .delete-mission {
    font-size: 0.8rem;
    padding: 0.25rem 0.5rem;
  }
  
  @media (max-width: 768px) {
    .mission-card .col-md-6 {
      margin-bottom: 0.5rem;
    }
  }
  

        :root {
            --secondary-blue: #2D76B6;
            --light-gray: #F4F4F9;
            --dark-gray: #333333;
            --light-blue: #E6F0FA; 
            --accent-orange: #FA8301;
            --primary-blue: #0A4B8C;
        }
        
        .text-primary-blue {
            color: var(--primary-blue);
        }
        
        .text-accent-orange {
            color: var(--accent-orange);
        }
        
        .bg-primary-blue {
            background-color: var(--primary-blue);
        }
        
        .bg-light-blue {
            background-color: var(--light-blue);
        }
        
        .bg-light-orange {
            background-color: var(--accent-orange);
        }
        
        .hover-effect {
            transition: all 0.3s ease;
            border: 1px solid rgba(13, 59, 102, 0.1);
        }
        
        .hover-effect:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(13, 59, 102, 0.15) !important;
        }
        
        .advantage-icon {
            width: 70px;
            height: 70px;
            border-radius: 16px;
            background: rgba(10, 75, 140, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            transition: all 0.3s ease;
        }
        
        .advantage-icon i {
            font-size: 1.8rem;
            color: var(--primary-blue);
        }
        
        .advantage-card:hover .advantage-icon {
            background: var(--primary-blue);
            transform: rotate(5deg) scale(1.05);
        }
        
        .advantage-card:hover .advantage-icon i {
            color: white;
        }
        
        .advantage-title {
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .advantage-text {
            color: #666;
            line-height: 1.6;
        }
        
        .section-title {
            color: var(--primary-blue);
            position: relative;
            padding-bottom: 15px;
        }
        
        .section-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 80px;
            height: 3px;
            background: var(--accent-orange);
        }
        
        .text-center .section-title:after {
            left: 50%;
            transform: translateX(-50%);
        }
    
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Configuration de base
    const container = document.getElementById('missions-container');
    const addBtn = document.getElementById('add-mission');
    const totalForms = document.getElementById('id_mission_set-TOTAL_FORMS');
    const missionCount = document.getElementById('mission-count');
    const maxForms = 5;
    let formCount = parseInt(totalForms.value);
    
    // Fonction pour mettre à jour le compteur
    function updateCounter() {
        const visibleForms = container.querySelectorAll('.mission-card:not([style*="display: none"])').length;
        missionCount.textContent = visibleForms;
        totalForms.value = visibleForms;
        return visibleForms;
    }
    
    // Fonction pour créer un nouveau formulaire
    function addNewForm() {
        const currentCount = updateCounter();
        if (currentCount >= maxForms) {
            alert(`Vous ne pouvez pas ajouter plus de ${maxForms} missions.`);
            return;
        }
        
        const template = document.getElementById('empty-form-template');
        const newForm = template.cloneNode(true);
        newForm.style.display = '';
        newForm.id = '';
        
        // Remplace __prefix__ par le nouvel index
        const newIndex = currentCount;
        newForm.innerHTML = newForm.innerHTML.replace(/__prefix__/g, newIndex);
        
        container.appendChild(newForm);
        totalForms.value = currentCount + 1;
        
        // Attache les événements
        attachDeleteEvent(newForm);
        updateCounter();
    }
    
    // Fonction pour attacher l'événement de suppression
    function attachDeleteEvent(formElement) {
        const deleteBtn = formElement.querySelector('.delete-mission');
        if (deleteBtn) {
            deleteBtn.addEventListener('click', function() {
                const formBlock = this.closest('.mission-card');
                const deleteInput = formBlock.querySelector('[name$="-DELETE"]');
                
                if (deleteInput) {
                    deleteInput.value = 'on';
                    formBlock.style.display = 'none';
                } else {
                    formBlock.remove();
                }
                
                updateCounter();
                renumberForms();
            });
        }
    }
    
    // Fonction pour renuméroter les formulaires
    function renumberForms() {
        const forms = container.querySelectorAll('.mission-card:not([style*="display: none"])');
        let index = 0;
        
        forms.forEach(form => {
            form.setAttribute('data-form-index', index);
            form.querySelectorAll('input, select, textarea').forEach(input => {
                const name = input.name.replace(/mission_set-\d+/, `mission_set-${index}`);
                input.name = name;
                if (input.id) {
                    const id = input.id.replace(/mission_set-\d+/, `mission_set-${index}`);
                    input.id = id;
                }
            });
            index++;
        });
        
        totalForms.value = index;
        updateCounter();
    }
    
    // Initialisation
    container.querySelectorAll('.mission-card').forEach(form => {
        attachDeleteEvent(form);
    });
    
    addBtn.addEventListener('click', addNewForm);
    updateCounter();
    
    // Gestion du fichier CV
    const cvInput = document.getElementById('id_cv');
    if (cvInput) {
        cvInput.addEventListener('change', function() {
            document.getElementById('cv-filename').textContent = 
                this.files[0]?.name || 'Aucun fichier sélectionné';
        });
    }
    
    // Validation Bootstrap
    (function() {
        'use strict';
        const forms = document.querySelectorAll('.needs-validation');
        
        Array.from(forms).forEach(function(form) {
            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                    
                    // Scroll vers le premier champ invalide
                    const firstInvalid = form.querySelector(':invalid');
                    if (firstInvalid) {
                        firstInvalid.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    }
                }
                
                form.classList.add('was-validated');
            }, false);
        });
    })();
});
</script>
{% endblock %}